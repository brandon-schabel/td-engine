<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dialog Test</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #1a1a1a;
      color: white;
      font-family: Arial, sans-serif;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #45a049;
    }
    #console {
      margin-top: 20px;
      padding: 10px;
      background: #000;
      border: 1px solid #333;
      border-radius: 5px;
      font-family: monospace;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
    }
    .log {
      margin: 2px 0;
    }
    .error {
      color: #ff6b6b;
    }
    .warn {
      color: #ffd93d;
    }
    .info {
      color: #4ecdc4;
    }
  </style>
</head>
<body>
  <h1>Dialog System Test</h1>
  <p>Click the buttons below to test the dialog system. Check the console output below.</p>
  
  <div>
    <button onclick="testBuildDialog()">Test Build Dialog</button>
    <button onclick="testInventoryDialog()">Test Inventory Dialog</button>
    <button onclick="testSettingsDialog()">Test Settings Dialog</button>
    <button onclick="checkDialogManager()">Check Dialog Manager</button>
    <button onclick="clearConsole()">Clear Console</button>
  </div>
  
  <div id="console"></div>
  
  <script type="module">
    // Import dialog components
    import { DialogManager } from '/src/ui/systems/DialogManager.js';
    import { BuildMenuDialog } from '/src/ui/components/dialogs/BuildMenuDialog.js';
    import { InventoryDialog } from '/src/ui/components/dialogs/InventoryDialog.js';
    import { SettingsDialog } from '/src/ui/components/dialogs/SettingsDialog.js';
    
    const consoleDiv = document.getElementById('console');
    
    // Override console methods to show in page
    const originalConsole = {
      log: console.log,
      error: console.error,
      warn: console.warn
    };
    
    function addToConsole(message, type = 'log') {
      const time = new Date().toLocaleTimeString();
      const div = document.createElement('div');
      div.className = `log ${type}`;
      div.textContent = `[${time}] ${message}`;
      consoleDiv.appendChild(div);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
      
      // Also log to real console
      originalConsole[type](message);
    }
    
    console.log = (msg) => addToConsole(msg, 'log');
    console.error = (msg) => addToConsole(msg, 'error');
    console.warn = (msg) => addToConsole(msg, 'warn');
    
    // Make functions global
    window.testBuildDialog = function() {
      console.log('Testing Build Dialog...');
      
      const dialogManager = DialogManager.getInstance();
      const buildDialog = new BuildMenuDialog({
        currentCurrency: 100,
        onTowerSelect: (type) => console.log(`Tower selected: ${type}`),
        onCancel: () => console.log('Build dialog cancelled')
      });
      
      dialogManager.register('test-build', buildDialog);
      dialogManager.show('test-build');
    };
    
    window.testInventoryDialog = function() {
      console.log('Testing Inventory Dialog...');
      
      const dialogManager = DialogManager.getInstance();
      const inventoryDialog = new InventoryDialog({
        items: [
          { type: 'DAMAGE_BOOST', name: 'Damage Boost', count: 2 },
          { type: 'SPEED_BOOST', name: 'Speed Boost', count: 1 }
        ],
        equippedSlots: {
          1: { type: 'DAMAGE_BOOST', name: 'Damage Boost' }
        },
        onItemEquip: (item, slot) => console.log(`Equipped ${item} to slot ${slot}`),
        onItemUnequip: (slot) => console.log(`Unequipped slot ${slot}`),
        onItemUse: (item) => console.log(`Used item: ${item}`)
      });
      
      dialogManager.register('test-inventory', inventoryDialog);
      dialogManager.show('test-inventory');
    };
    
    window.testSettingsDialog = function() {
      console.log('Testing Settings Dialog...');
      
      const dialogManager = DialogManager.getInstance();
      const settingsDialog = new SettingsDialog({
        onVolumeChange: (volume) => console.log(`Volume changed to: ${volume}`),
        onMuteToggle: (muted) => console.log(`Mute toggled: ${muted}`)
      });
      
      dialogManager.register('test-settings', settingsDialog);
      dialogManager.show('test-settings');
    };
    
    window.checkDialogManager = function() {
      console.log('Checking Dialog Manager...');
      const dialogManager = DialogManager.getInstance();
      console.log('Dialog Manager instance:', dialogManager);
      console.log('Open dialogs:', dialogManager.getOpenDialogs());
      console.log('Any dialog open?', dialogManager.isAnyDialogOpen());
    };
    
    window.clearConsole = function() {
      consoleDiv.innerHTML = '';
      console.log('Console cleared');
    };
    
    // Initial message
    console.log('Dialog test page loaded. Click buttons to test dialogs.');
  </script>
</body>
</html>