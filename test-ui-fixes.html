<!DOCTYPE html>
<html>
<head>
    <title>UI Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #444;
            border-radius: 8px;
        }
        .test-button {
            padding: 10px 20px;
            margin: 5px;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button:hover {
            background: #005f99;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
    </style>
</head>
<body>
    <h1>TD Engine UI Fix Test Suite</h1>
    
    <div class="test-section">
        <h2>BS-14: Build Menu Glitching Test</h2>
        <p>Test that the build menu doesn't flicker when opened multiple times</p>
        <button class="test-button" onclick="testBuildMenu()">Test Build Menu</button>
        <div id="build-menu-status" class="status"></div>
    </div>

    <div class="test-section">
        <h2>BS-16: Player Upgrades Menu Reopening Test</h2>
        <p>Test that player upgrades menu can be reopened after closing</p>
        <button class="test-button" onclick="testPlayerUpgrades()">Test Player Upgrades</button>
        <div id="player-upgrades-status" class="status"></div>
    </div>

    <div class="test-section">
        <h2>BS-17: Inventory Reopening Test</h2>
        <p>Test that inventory can be reopened after closing</p>
        <button class="test-button" onclick="testInventory()">Test Inventory</button>
        <div id="inventory-status" class="status"></div>
    </div>

    <div class="test-section">
        <h2>BS-22: Build Mode UI State Test</h2>
        <p>Test that build mode hides HUD elements during tower placement</p>
        <button class="test-button" onclick="testBuildMode()">Test Build Mode</button>
        <div id="build-mode-status" class="status"></div>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
        }

        async function testBuildMenu() {
            const statusId = 'build-menu-status';
            document.getElementById(statusId).innerHTML = '';
            
            log(statusId, 'Starting build menu test...');
            
            try {
                // Open game in iframe
                log(statusId, 'Opening build menu first time...');
                // Simulate button click
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                log(statusId, 'Closing build menu...');
                
                await new Promise(resolve => setTimeout(resolve, 500));
                log(statusId, 'Opening build menu second time...');
                
                log(statusId, 'Test completed - Check for flickering manually', 'success');
            } catch (error) {
                log(statusId, `Error: ${error.message}`, 'error');
            }
        }

        async function testPlayerUpgrades() {
            const statusId = 'player-upgrades-status';
            document.getElementById(statusId).innerHTML = '';
            
            log(statusId, 'Starting player upgrades test...');
            
            try {
                log(statusId, 'Opening player upgrades first time...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                log(statusId, 'Closing player upgrades...');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                log(statusId, 'Attempting to reopen player upgrades...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                log(statusId, 'Test completed - Menu should reopen correctly', 'success');
            } catch (error) {
                log(statusId, `Error: ${error.message}`, 'error');
            }
        }

        async function testInventory() {
            const statusId = 'inventory-status';
            document.getElementById(statusId).innerHTML = '';
            
            log(statusId, 'Starting inventory test...');
            
            try {
                log(statusId, 'Opening inventory first time...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                log(statusId, 'Closing inventory...');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                log(statusId, 'Attempting to reopen inventory...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                log(statusId, 'Test completed - Inventory should reopen correctly', 'success');
            } catch (error) {
                log(statusId, `Error: ${error.message}`, 'error');
            }
        }

        async function testBuildMode() {
            const statusId = 'build-mode-status';
            document.getElementById(statusId).innerHTML = '';
            
            log(statusId, 'Starting build mode test...');
            
            try {
                log(statusId, 'Selecting tower for placement...');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                log(statusId, 'Entering build mode - HUD should be hidden...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                log(statusId, 'Placing tower or pressing ESC...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                log(statusId, 'Exiting build mode - HUD should reappear...');
                log(statusId, 'Test completed - Check HUD visibility changes', 'success');
            } catch (error) {
                log(statusId, `Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>